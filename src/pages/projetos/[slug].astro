---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getEntryBySlug } from "astro:content";

const { slug } = Astro.params;
const entry = await getEntryBySlug("posts", slug!);

if (!entry) {
  return new Response(null, { status: 404, statusText: "Post não encontrado" });
}

const { Content } = await entry.render();
const meta = entry.data as {
  title: string;
  excerpt?: string;
  date: Date | string;
  category?: string;
  cover?: string;
  author?: string;
};

const published = new Date(meta.date);
const dateLabel = published.toLocaleDateString("pt-BR", {
  day: "2-digit",
  month: "long",
  year: "numeric",
});
---

<BaseLayout title={`${meta.title} — PonttoArq`}>
  <article class="container-arch py-10 md:py-16">
    {meta.cover && (
      <img src={meta.cover} alt={meta.title} class="w-full aspect-[16/9] object-cover rounded-lg border border-neutral-200" />
    )}

    <header class="max-w-3xl mt-6">
      {meta.category && (
        <a href="#" class="inline-flex items-center text-xs tracking-wide uppercase text-neutral-500">{meta.category}</a>
      )}
      <h1 class="mt-2 text-4xl md:text-5xl font-semibold leading-tight">{meta.title}</h1>
      {meta.excerpt && (
        <p class="mt-3 text-neutral-600">{meta.excerpt}</p>
      )}
      <div class="mt-4 text-sm text-neutral-500 flex flex-wrap items-center gap-x-2">
        {meta.author && <span>{meta.author}</span>}
        <span aria-hidden="true">•</span>
        <time datetime={published.toISOString()}>{dateLabel}</time>
      </div>
    </header>

    <div class="mt-10 max-w-3xl leading-relaxed text-neutral-800 space-y-6">
      <Content />
    </div>
  </article>
</BaseLayout>